version: "3.8"

networks:
  app-network:
    external: true

services:
  api:
    image: guolee/dailyhot-api:latest
    container_name: api
    user: "114514:114514"
    restart: always
    build:
      context: .
      target: runner
    ports:
      - "37291:6688"
    volumes:
      - "./logs:/app/logs"
    networks:
      - app-network
    environment:
      - NODE_ENV=docker
      - PORT=6688
      - LANG=en_US.UTF-8
      - LANGUAGE=en_US.UTF-8
      - LC_ALL=en_US.UTF-8
      - USE_LOG_FILE=true
      - REDIS_HOST=redis
      - REDIS_PORT=16319
      - REDIS_PASSWORD=
      - ALLOWED_DOMAIN=["www.guole.fun", "blog.guole.fun", "hot.guole.fun", "api.guole.fun", "guole.fun", "kuole-o.github.io", "127.0.0.1"]
      - GAODE_KEY=
      - UMAMI_USER_NAME=
      - UMAMI_USER_PASSWORD=
      - UMAMI_TOKEN=
      - LEANCLOUD_APPID='LeanCloud应用ID'
      - LEANCLOUD_APPKEY='LeanCloud应用Key'
      - QINIU_ACCESS_KEY='七牛云AccessKey'
      - QINIU_SECRET_KEY='七牛云SecretKey'
      - QINIU_BUCKET='七牛云存储桶名称'
      - WEBDAV_SERVER='WebDAV服务器地址'
      - WEBDAV_USERNAME='WebDAV用户名'
      - WEBDAV_PASSWORD='WebDAV密码'
      - WEBDAV_CERT_PATH='WebDAV证书路径'
      - CERT_FILE_NAME='证书文件名'
      - KEY_FILE_NAME='私钥文件名'
      - DATA_DIR='旧证书id存储路径'
      - SSL_SECRET_KEY='证书更新接口的鉴权token'
      - BBTALK_TOKEN='自定义授权秘钥'
      - BBTALK_PAGE_SIZE=10
      - BBTALK_JSON_PATH='存储桶上传目标路径'
      - LEANCLOUD_APP_ID='LeanCloud应用ID'
      - LEANCLOUD_APP_KEY='LeanCloud应用Key'
      - LEANCLOUD_MASTER_KEY='LeanCloud主密钥'
      - LEANCLOUD_SERVER_URL='自定义leancloud服务地址'